# K3S Server Configuration
# Generated by Ansible

{% if web_role == 'server' %}
# Server configuration
write-kubeconfig-mode: "0644"
tls-san:
  - "{{ k3s_api_san }}"
  - "{{ inventory_hostname }}"
{% if k3s_disable_traefik %}
disable:
  - traefik
{% endif %}

# Audit logging
kube-apiserver-arg:
  - "audit-log-path=/var/log/k3s-audit.log"
  - "audit-log-maxage=30"
  - "audit-log-maxbackup=10"
  - "audit-log-maxsize=100"

# Cluster settings
cluster-cidr: "10.42.0.0/16"
service-cidr: "10.43.0.0/16"
cluster-dns: "10.43.0.10"
cluster-domain: "{{ cluster_domain | default('cluster.local') }}"

{% elif web_role == 'agent' %}
# Agent configuration
server: "https://{{ k3s_master_ip }}:6443"
{% endif %}
