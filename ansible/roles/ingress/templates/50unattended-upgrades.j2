// Unattended-Upgrades configuration
// Managed by Ansible - do not edit manually

// Only install security updates
Unattended-Upgrade::Allowed-Origins {
    "${distro_id}:${distro_codename}";
    "${distro_id}:${distro_codename}-security";
    "${distro_id}ESMApps:${distro_codename}-apps-security";
    "${distro_id}ESM:${distro_codename}-infra-security";
};

// Packages to NOT update automatically
Unattended-Upgrade::Package-Blacklist {
    // Keep kernel and drivers stable
    // "linux-";
    // "nvidia-";
};

// Split upgrades into smaller chunks
Unattended-Upgrade::MinimalSteps "true";

// Email notifications
Unattended-Upgrade::Mail "{{ ingress_unattended_mail }}";
Unattended-Upgrade::MailReport "only-on-error";

// Remove unused dependencies
Unattended-Upgrade::Remove-Unused-Dependencies "true";

// Automatic reboot if required
{% if ingress_unattended_reboot %}
Unattended-Upgrade::Automatic-Reboot "true";
Unattended-Upgrade::Automatic-Reboot-Time "03:00";
{% else %}
Unattended-Upgrade::Automatic-Reboot "false";
{% endif %}

// Remove new unused dependencies after upgrade
Unattended-Upgrade::Remove-New-Unused-Dependencies "true";

// Enable syslog logging
Unattended-Upgrade::SyslogEnable "true";
Unattended-Upgrade::SyslogFacility "daemon";

// Verbose logging
Unattended-Upgrade::Verbose "false";

// Debug mode
Unattended-Upgrade::Debug "false";
