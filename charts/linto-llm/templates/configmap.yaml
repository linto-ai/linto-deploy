{{- if .Values.llmGatewayApi.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "linto-llm.fullname" . }}-llm-api-config
  labels:
    {{- include "linto-llm.labels" . | nindent 4 }}
    app.kubernetes.io/component: llm-api
data:
  # Database connection (password injected via env var)
  POSTGRES_HOST: {{ include "linto-llm.postgresHost" . | quote }}
  POSTGRES_PORT: "5432"
  POSTGRES_DB: "llm_DB"
  POSTGRES_USER: "llm_user"
  # Note: DATABASE_URL is set in deployment.yaml with proper asyncpg driver
  # Redis connection (password injected via env var)
  REDIS_HOST: {{ include "linto-llm.redisHost" . | quote }}
  REDIS_PORT: "6379"
  # Celery broker URL
  CELERY_BROKER_URL: {{ include "linto-llm.celeryBrokerUrl" . | quote }}
  CELERY_RESULT_BACKEND: {{ include "linto-llm.celeryBrokerUrl" . | quote }}
  # API settings
  HTTP_PORT: "80"
  PYTHONUNBUFFERED: "1"
  DEBUG: {{ .Values.llmGatewayApi.env.DEBUG | default "false" | quote }}
  CORS_ORIGINS: {{ .Values.llmGatewayApi.env.CORS_ORIGINS | default (printf "https://%s" .Values.global.domain) | quote }}
{{- end }}
---
{{- if .Values.llmGatewayFrontend.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "linto-llm.fullname" . }}-llm-frontend-config
  labels:
    {{- include "linto-llm.labels" . | nindent 4 }}
    app.kubernetes.io/component: llm-frontend
data:
  # API and WebSocket URLs - relative to the frontend path, accessed via browser
  # Frontend code adds /api/v1/ prefix to all API calls
  NEXT_PUBLIC_API_URL: "{{ .Values.llmGatewayFrontend.ingress.path }}/api"
  # WebSocket: frontend code adds /ws/jobs/{id}, so base URL is just the frontend path
  NEXT_PUBLIC_WS_URL: "wss://{{ .Values.global.domain }}{{ .Values.llmGatewayFrontend.ingress.path }}"
  BASE_PATH: {{ .Values.llmGatewayFrontend.ingress.path | quote }}
{{- end }}
